<!DOCTYPE html>
<html>
<head>
    <title>Car Runner â€“ Sky Background + Cars</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; }
        #score, #level {
            position: absolute;
            left: 10px;
            color: white;
            font-family: Arial;
            z-index: 10;
        }
        #score { top: 10px; font-size: 24px; }
        #level { top: 45px; font-size: 22px; }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <div id="level">Level: 1</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        let scene = new THREE.Scene();

        // SKY BACKGROUND + FOG
        scene.fog = new THREE.Fog(0x87CEEB, 10, 200);

        let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        let renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        //-------------------------------------------------------
        // PLAYER CAR
        //-------------------------------------------------------
        function createPlayerCar() {
            let group = new THREE.Group();

            // Car body
            let bodyGeo = new THREE.BoxGeometry(1.5, 0.5, 3);
            let bodyMat = new THREE.MeshBasicMaterial({ color: 0x1E90FF });
            let body = new THREE.Mesh(bodyGeo, bodyMat);
            body.position.y = 0.5;
            group.add(body);

            // Car roof
            let roofGeo = new THREE.BoxGeometry(1, 0.4, 1.5);
            let roofMat = new THREE.MeshBasicMaterial({ color: 0x4682B4 });
            let roof = new THREE.Mesh(roofGeo, roofMat);
            roof.position.set(0, 0.9, -0.2);
            group.add(roof);

            group.position.set(0, 1, 5);
            return group;
        }

        let player = createPlayerCar();
        scene.add(player);

        //-------------------------------------------------------
        // ROAD
        //-------------------------------------------------------
        let roadGeo = new THREE.BoxGeometry(10, 0.2, 200);
        let roadMat = new THREE.MeshBasicMaterial({ color: 0x333333 });
        let road = new THREE.Mesh(roadGeo, roadMat);
        road.position.set(0, 0, -90);
        scene.add(road);

        camera.position.set(0, 4, 12);
        camera.lookAt(player.position);

        let laneX = 0;
        document.addEventListener("keydown", e => {
            if (e.key === "ArrowLeft" && laneX > -2) laneX -= 2;
            if (e.key === "ArrowRight" && laneX < 2) laneX += 2;
        });

        //-------------------------------------------------------
        // LEVEL SYSTEM
        //-------------------------------------------------------
        let level = 1;
        let speed = 0.5;
        let spawnRate = 1400;
        let score = 0;
        let obstacleSize = 2;

        const levelThresholds = [
            0,      // L1
            200,    // L2
            1000,   // L3
            10000,  // L4
            20000,
            30000,
            45000,
            60000,
            80000,
            110000
        ];

        //-------------------------------------------------------
        // OBSTACLE CARS
        //-------------------------------------------------------
        let obstacles = [];

        function createCarObstacle() {
            let group = new THREE.Group();

            // Car body
            let bodyGeo = new THREE.BoxGeometry(1.6, 0.5, obstacleSize);
            let bodyMat = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            let body = new THREE.Mesh(bodyGeo, bodyMat);
            body.position.y = 0.5;
            group.add(body);

            // Roof
            let roofGeo = new THREE.BoxGeometry(1, 0.4, obstacleSize / 1.6);
            let roofMat = new THREE.MeshBasicMaterial({ color: 0x8B0000 });
            let roof = new THREE.Mesh(roofGeo, roofMat);
            roof.position.set(0, 0.9, -0.3);
            group.add(roof);

            return group;
        }

        function spawnObstacle() {
            let obs = createCarObstacle();
            let lane = [-2, 0, 2][Math.floor(Math.random() * 3)];
            obs.position.set(lane, 1, -120);
            scene.add(obs);
            obstacles.push(obs);
        }

        let spawnInterval = setInterval(spawnObstacle, spawnRate);

        //-------------------------------------------------------
        // UPDATE LEVELS
        //-------------------------------------------------------
        function updateLevel() {
            for (let i = 1; i <= 10; i++) {
                if (score >= levelThresholds[i] && level < i + 1) {
                    level = i + 1;
                    speed += 0.2;
                    obstacleSize += 0.2;

                    clearInterval(spawnInterval);
                    spawnRate = Math.max(400, spawnRate - 120);
                    spawnInterval = setInterval(spawnObstacle, spawnRate);

                    document.getElementById("level").innerText = "Level: " + level;
                }
            }
        }

        //-------------------------------------------------------
        // GAME LOOP
        //-------------------------------------------------------
        function animate() {
            requestAnimationFrame(animate);

            player.position.x += (laneX - player.position.x) * 0.25;

            // Move obstacles
            for (let obs of obstacles) {
                obs.position.z += speed;

                if (
                    Math.abs(player.position.x - obs.position.x) < 1.3 &&
                    Math.abs(player.position.z - obs.position.z) < 1.5
                ) {
                    alert("Game Over! Score: " + score);
                    window.location.reload();
                }
            }

            score++;
            document.getElementById("score").innerText = "Score: " + score;

            updateLevel();
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
